<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2. 원장 스타일 진단 결과</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="type-theme">
    <!-- 네비게이션 바 -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="2.index-type.html" class="navbar-brand">
                <span>🏥</span>
                <span>2. 원장 스타일 진단</span>
            </a>

            <button class="navbar-toggle" onclick="toggleMenu()">
                ☰
            </button>

            <ul class="navbar-menu" id="navbarMenu">
                <li><a href="2.index-type.html">홈</a></li>
                <li><a href="2.index-type.html#start">진단 시작</a></li>
                <li><a href="2.test-demo-type.html">시연 보기</a></li>
                <li><a href="1.index-revenue.html">1. 수익 단계별 진단</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="result-header">
            <h1 id="hospitalInfo" style="font-size: 1.8rem; margin-bottom: 8px;"></h1>
            <p id="hospitalDetail" style="font-size: 0.95rem; opacity: 0.85; margin-bottom: 15px;"></p>
            <p style="font-size: 1.5rem; font-weight: bold; color: #fbbf24; margin: 15px 0 5px 0; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">2. 원장 스타일 5유형 진단 결과</p>
            <p id="diagnosisDate" style="font-size: 0.95rem; margin-top: 8px; opacity: 0.85;"></p>
        </div>

        <!-- 분석 결과 개요 -->
        <div id="diagnosisSummaryBox" style="background: linear-gradient(135deg, #eff6ff, #dbeafe); border-left: 5px solid #2563eb; padding: 25px 30px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);">
            <h3 style="color: #2563eb; margin-bottom: 15px; font-size: 1.2rem; font-weight: bold;">📊 진단 결과 개요</h3>
            <p id="diagnosisSummary" style="font-size: 1.05rem; line-height: 1.9; color: #1f2937; margin: 0;"></p>
        </div>

        <main>
            <!-- 점수 요약 -->
            <div class="report-section">
                <h2>진단 점수 요약</h2>

                <!-- 레이더 차트 -->
                <div style="max-width: 600px; margin: 0 auto 25px;">
                    <canvas id="radarChart"></canvas>
                </div>

                <!-- 점수 카드 -->
                <div class="score-summary" id="scoreSummary"></div>
            </div>

            <!-- 주 유형 -->
            <div class="report-section">
                <h2>주 유형</h2>
                <div class="highlight-box">
                    <h3 id="primaryTypeName" style="color: #2563eb; font-size: 1.5rem; font-weight: bold; margin-bottom: 15px;"></h3>
                    <p id="primaryTypeDescription" style="font-size: 1.1rem; line-height: 1.8;"></p>
                </div>

                <h3 style="margin-top: 25px; color: #2563eb; font-size: 1.15rem; font-weight: bold;">주요 특징</h3>
                <ul id="primaryCharacteristics" style="line-height: 1.8;"></ul>

                <h3 style="margin-top: 25px; color: #2563eb; font-size: 1.15rem; font-weight: bold;">제안 키워드</h3>
                <div id="primaryKeywords" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;"></div>
            </div>

            <!-- 보조 유형 -->
            <div class="report-section">
                <h2>보조 유형</h2>
                <div style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-left: 5px solid #10b981; padding: 25px; border-radius: 10px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);">
                    <h3 id="secondaryTypeName" style="color: #10b981; font-size: 1.4rem; font-weight: bold; margin-bottom: 15px;"></h3>
                    <p id="secondaryTypeDescription" style="font-size: 1.05rem; line-height: 1.8;"></p>
                </div>

                <h3 style="margin-top: 25px; color: #10b981; font-size: 1.15rem; font-weight: bold;">보조 특징</h3>
                <ul id="secondaryCharacteristics" style="line-height: 1.8;"></ul>
            </div>

            <!-- 맞춤 제안 -->
            <div class="report-section">
                <h2>맞춤 제안 방향</h2>
                <div class="highlight-box">
                    <p id="proposalMessage" style="font-size: 1.1rem; line-height: 1.8;"></p>
                </div>
            </div>

            <!-- 전략 로드맵 -->
            <div class="report-section">
                <h2>병원 맞춤 전략 로드맵</h2>
                <div id="roadmapContainer"></div>
            </div>

            <!-- AI 맞춤형 피드백 (주관식 답변 기반) -->
            <div class="report-section" id="customFeedbackSection" style="display: none;">
                <h2>🎯 AI 맞춤형 피드백</h2>
                <p style="color: #6b7280; margin-bottom: 25px; line-height: 1.7;">
                    원장님의 주관식 답변을 AI가 분석하여 맞춤형 피드백과 실행 방안을 제시합니다.
                </p>
                <div id="customFeedbackContent"></div>
            </div>

            <!-- 원장님의 의견 (주관식 답변) -->
            <div class="report-section" id="essayAnswersSection" style="display: none;">
                <h2>원장님의 의견</h2>
                <p style="color: #6b7280; margin-bottom: 25px; line-height: 1.7;">
                    원장님께서 직접 작성해 주신 답변입니다. 이 내용은 맞춤 컨설팅 제안에 중요하게 활용됩니다.
                </p>
                <div id="essayAnswersContent"></div>
            </div>

            <!-- 액션 버튼 -->
            <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn-primary" onclick="window.print()" style="flex: 1; min-width: 200px;">
                    결과 출력하기
                </button>
                <button class="btn-primary" onclick="showEmailModal()" style="flex: 1; min-width: 200px; background: #10b981;">
                    이메일로 받기
                </button>
            </div>

            <!-- 진단 완료 메시지 -->
            <div style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid #86efac; border-radius: 12px; padding: 30px; margin-top: 30px; text-align: center;">
                <h3 style="color: #1f2937; font-size: 1.4rem; margin-bottom: 15px;">🎉 통합 진단이 완료되었습니다!</h3>
                <p style="color: #6b7280; margin-bottom: 25px; line-height: 1.7;">
                    <strong>1. 병원 수익 단계별 진단</strong>과 <strong>2. 원장 스타일 진단</strong>이 모두 완료되었습니다.<br>
                    두 진단 결과를 종합하여 병원에 최적화된 맞춤 솔루션이 제시되었습니다.
                </p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="window.location.href='1.result-revenue.html'" style="background: #2563eb; padding: 15px 30px;">
                        📊 1. 수익 진단 결과 다시 보기
                    </button>
                    <button class="btn-secondary" onclick="window.location.href='index.html'" style="padding: 15px 30px;">
                        🏠 처음으로 돌아가기
                    </button>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2026 치과병원 컨설팅 솔루션 | 2. 원장 스타일 진단 시스템</p>
            <a href="manager-dashboard.html" class="manager-dashboard-btn" style="display: inline-block; background: rgba(31, 41, 55, 0.8); color: rgba(255, 255, 255, 0.7); padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 0.75rem; font-weight: 500; margin-top: 10px;">🔐 매니저 대시보드</a>
        </footer>
    </div>

    <!-- 이메일 받기 모달 -->
    <div id="emailModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; padding: 40px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <h2 style="margin-bottom: 20px; color: #2563eb;">진단 결과 이메일로 받기</h2>
            <p style="color: #6b7280; margin-bottom: 30px;">진단 결과를 이메일과 문자로 받아보실 수 있습니다.</p>

            <form id="emailForm">
                <div class="form-group">
                    <label for="userEmail">이메일 주소 *</label>
                    <input type="email" id="userEmail" required placeholder="example@email.com">
                </div>

                <div class="form-group">
                    <label for="userPhone">휴대폰 번호 *</label>
                    <input type="tel" id="userPhone" required placeholder="010-0000-0000">
                </div>

                <div class="form-group">
                    <label for="userMessage">질문 또는 추가 요청사항</label>
                    <textarea id="userMessage" rows="4" style="width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; font-family: inherit; resize: vertical;" placeholder="궁금하신 점이나 추가로 요청하실 사항을 입력해 주세요."></textarea>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button type="button" class="btn-secondary" onclick="closeEmailModal()" style="flex: 1;">
                        취소
                    </button>
                    <button type="submit" class="btn-primary" style="flex: 1;">
                        전송
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 모바일 메뉴 토글
        function toggleMenu() {
            const menu = document.getElementById('navbarMenu');
            menu.classList.toggle('active');
        }

        // 메뉴 외부 클릭 시 닫기
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('navbarMenu');
            const toggle = document.querySelector('.navbar-toggle');
            const navbar = document.querySelector('.navbar');

            if (menu && toggle && navbar && !navbar.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // 이메일 모달 표시
        function showEmailModal() {
            const modal = document.getElementById('emailModal');
            modal.style.display = 'flex';
        }

        // 이메일 모달 닫기
        function closeEmailModal() {
            const modal = document.getElementById('emailModal');
            modal.style.display = 'none';
            document.getElementById('emailForm').reset();
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('emailModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeEmailModal();
            }
        });

        // 이메일 폼 제출
        document.getElementById('emailForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const userEmail = document.getElementById('userEmail').value;
            const userPhone = document.getElementById('userPhone').value;
            const userMessage = document.getElementById('userMessage').value;

            // 진단 데이터 가져오기
            const clinicName = sessionStorage.getItem('clinicName');
            const directorName = sessionStorage.getItem('directorName');
            const region = sessionStorage.getItem('region');

            // 여기서 실제로는 서버로 데이터를 전송해야 합니다
            // 현재는 콘솔에 로그만 출력하고 알림을 표시합니다
            console.log('이메일 전송 요청:', {
                email: userEmail,
                phone: userPhone,
                message: userMessage,
                clinic: clinicName,
                director: directorName,
                region: region
            });

            // localStorage의 diagnosisHistory에 이메일 정보 추가
            try {
                let history = JSON.parse(localStorage.getItem('diagnosisHistory') || '[]');

                // 병원명과 원장명으로 기존 기록 찾기
                const existingIndex = history.findIndex(h =>
                    h.clinicName === clinicName &&
                    h.directorName === directorName
                );

                if (existingIndex >= 0) {
                    // 2번 진단의 이메일 정보 업데이트
                    if (!history[existingIndex].emailRequests) {
                        history[existingIndex].emailRequests = {};
                    }
                    history[existingIndex].emailRequests.diagnosis2 = {
                        email: userEmail,
                        phone: userPhone,
                        message: userMessage,
                        requestDate: new Date().toISOString()
                    };
                    history[existingIndex].timestamp = Date.now();

                    // localStorage에 저장
                    localStorage.setItem('diagnosisHistory', JSON.stringify(history));
                    console.log('이메일 정보 저장 완료 (2번 진단)');
                }
            } catch (error) {
                console.error('이메일 정보 저장 실패:', error);
            }

            // 알림 표시
            alert('진단 결과 전송이 요청되었습니다.\n\n' +
                  '이메일: ' + userEmail + '\n' +
                  '휴대폰: ' + userPhone + '\n\n' +
                  '※ 실제 이메일/문자 전송 기능은 서버 연동 후 활성화됩니다.');

            closeEmailModal();
        });
    </script>
    <script src="js/essay-feedback.js"></script>
    <script src="js/2.analysis-type.js"></script>
    <script src="js/2.report-type.js"></script>
</body>
</html>
